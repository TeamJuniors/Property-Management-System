{"version":3,"file":"proxy-document.js","sourceRoot":"","sources":["../../../../../../modules/universal/src/node/proxy-document.ts"],"names":[],"mappings":"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","sourcesContent":["import { getDOM } from '../lib';\n\ndeclare var Zone: any;\n\nexport class ProxyElement {\n  get _zone() { return this.__zone || Zone.current; }\n  constructor(private __zone?: any) { }\n  get querySelector() {\n    const parentElement = this._zone.get('parentElement');\n    const _zone = this._zone.fork({\n      name: 'ProxyElement.querySelector',\n      properties: { parentElement }\n    });\n    return _zone.wrap(querySelector, 'ProxyElement.querySelector');\n  }\n  get querySelectorAll() {\n    const parentElement = this._zone.get('parentElement');\n    const _zone = this._zone.fork({\n      name: 'ProxyElement.querySelectorAll',\n      properties: { parentElement }\n    });\n    return _zone.wrap(querySelectorAll, 'ProxyElement.querySelector');\n  }\n  get tagName() {\n    const el = this._zone.get('element');\n    return el.tagName;\n  }\n  get value() {\n    const el = this._zone.get('element');\n    return el.value;\n  }\n  get nodeName() {\n    const el = this._zone.get('element');\n    return el.tagName;\n  }\n  get nodeValue() {\n    const el = this._zone.get('element');\n    return el.nodeValue;\n  }\n  get firstChild(): any {\n    const DOM = getDOM();\n    const parentElement = this._zone.get('element');\n    const _zone = this._zone.fork({\n      name: 'ProxyElement.querySelector',\n      properties: { parentElement }\n    });\n    return _zone.run(() => DOM.firstChild(parentElement));\n  }\n  get nextSibling() {\n    const el = this._zone.get('element');\n    return el.nextSibling;\n  }\n  get parentElement() {\n    const el = this._zone.get('element');\n    return el.parent;\n  }\n  get childNodes(): any {\n    const DOM = getDOM();\n    const parentElement = this._zone.get('element');\n    const _zone = this._zone.fork({\n      name: 'ProxyElement.querySelector',\n      properties: { parentElement }\n    });\n    return _zone.run(() => DOM.childNodes(parentElement));\n  }\n\n  createElement(tagName: any) {\n    const DOM = getDOM();\n    return DOM.createElement(tagName);\n  }\n}\n\nexport class ProxyDocument {\n  get _zone() { return this.__zone || Zone.current; }\n  constructor(private __zone?: any) { }\n  get querySelector() {\n    const document = this._zone.get('document');\n    const zone = this._zone.fork({\n      name: 'ProxyDocument.querySelector',\n      properties: {\n        parentElement: document\n      }\n    });\n    return zone.wrap(querySelector, 'ProxyDocument.querySelector');\n  }\n  get querySelectorAll() {\n    const document = this._zone.get('document');\n    const _zone = this._zone.fork({\n      name: 'ProxyDocument.querySelectorAll',\n      properties: {\n        parentElement: document\n      }\n    });\n    return _zone.wrap(querySelectorAll, 'ProxyDocument.querySelector');\n  }\n  get tagName() {\n    const el = this._zone.get('document');\n    return el.tagName;\n  }\n  get cookie() {\n    const el = this._zone.get('cookie');\n    return el.cookie;\n  }\n\n  createElement(tagName: any) {\n    const DOM = getDOM();\n    return DOM.createElement(tagName);\n  }\n}\n\n\nexport function createDocumentProxy() {\n  return new ProxyDocument();\n}\n\nexport function createGlobalProxy() {\n\n  var originalDocumentRef = (<any>global).document;\n  if (originalDocumentRef instanceof ProxyDocument) {\n    return originalDocumentRef;\n  }\n\n  const document = createDocumentProxy();\n  Object.defineProperty((<any>global), 'document', {\n    enumerable: false,\n    configurable: false,\n    get: function() {\n      const doc: any = Zone.current.get('document');\n      if (doc) {\n        return document;\n      }\n      return originalDocumentRef;\n    },\n    set: function(_newValue) {\n\n    }\n  });\n\n  return document;\n}\n\n\n\nfunction querySelector(query) {\n  const DOM = getDOM();\n  var parentElement = Zone.current.get('parentElement');\n  var element = DOM.querySelector(parentElement, query);\n  var zone = Zone.current.fork({\n    name: 'querySelector',\n    properties: { parentElement, element }\n  });\n  return new ProxyElement(zone);\n}\n\nfunction querySelectorAll(query) {\n  const DOM = getDOM();\n  var parentElement = Zone.current.get('parentElement');\n  var element = DOM.querySelectorAll(parentElement, query);\n  var zone = Zone.current.fork({\n    name: 'querySelector',\n    properties: { parentElement, element }\n  });\n  return new ProxyElement(zone);\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}