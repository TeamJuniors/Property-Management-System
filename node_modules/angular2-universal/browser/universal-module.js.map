{"version":3,"file":"universal-module.js","sourceRoot":"","sources":["../../../../../../modules/universal/src/browser/universal-module.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  NgModule,\n  APP_ID,\n  Inject,\n  APP_BOOTSTRAP_LISTENER,\n  createPlatformFactory,\n  PlatformRef,\n  OpaqueToken,\n} from '@angular/core';\nimport { HttpModule, JsonpModule } from '@angular/http';\n\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\n\nimport {\n  BrowserModule,\n  __platform_browser_private__\n} from '@angular/platform-browser';\n\ndeclare var require: any;\n\nvar prebootClient;\ntry {\n  // legacy preboot APIs\n  prebootClient = require('preboot/__build/src/browser/preboot_browser');\n  prebootClient = (prebootClient && prebootClient.prebootClient) || prebootClient;\n} catch (e) {}\n\n// @internal\nfunction _randomChar() {\n  return String.fromCharCode(97 + Math.floor(Math.random() * 25));\n}\n// @internal\nfunction _appIdRandomProviderFactory() {\n  return `${_randomChar()}${_randomChar()}${_randomChar()}`;\n}\n// PRIVATE\n\nconst SharedStylesHost: any = __platform_browser_private__.SharedStylesHost;\n\nexport const UNIVERSAL_CACHE = new OpaqueToken('UNIVERSAL_CACHE');\nexport const AUTO_PREBOOT = new OpaqueToken('AUTO_PREBOOT');\n\nexport function universalCacheFactory() {\n  let _win: any = window;\n  let CACHE = Object.assign({}, _win.UNIVERSAL_CACHE || {});\n  delete _win.UNIVERSAL_CACHE;\n  return CACHE;\n}\n\nexport function appIdFactory() {\n  let _win: any = window;\n  let CACHE = _win.UNIVERSAL_CACHE || {};\n  let appId = null;\n  if (CACHE.APP_ID) {\n    appId = CACHE.APP_ID;\n  } else {\n    appId = _appIdRandomProviderFactory();\n  }\n  return appId;\n}\n\nexport function appBootstrapListenerFactory(autoPreboot: boolean) {\n  return autoPreboot ? prebootComplete : () => {};\n}\n\nexport function prebootComplete(value?: any) {\n  let _win: any = window;\n  if (_win && prebootClient) {\n    setTimeout(() => prebootClient().complete());\n  }\n  return value;\n}\n\n\nexport class UniversalModule {\n  constructor( sharedStylesHost: any) {\n    const domStyles = document.head.querySelectorAll('style');\n    const styles = Array.prototype.slice.call(domStyles)\n      .filter((style) => (style.innerText || style.textContent).indexOf('_ng') !== -1)\n      .map((style) => (style.innerText || style.textContent));\n\n    styles.forEach(style => {\n      sharedStylesHost._stylesSet.add(style);\n      sharedStylesHost._styles.push(style);\n    });\n  }\n  static withConfig(_config: any = {}): {ngModule: UniversalModule, providers: any[]} {\n    const providers = [];\n\n    if (typeof _config.autoPreboot === 'boolean') {\n      providers.push({\n        provide: AUTO_PREBOOT,\n        useValue: _config.autoPreboot,\n      });\n    }\n\n    return {\n      ngModule: UniversalModule,\n      providers: providers,\n    };\n  }\nstatic decorators: DecoratorInvocation[] = [\n{ type: NgModule, args: [{\n  imports: [\n  ],\n  exports: [\n    BrowserModule,\n    HttpModule,\n    JsonpModule\n  ],\n  providers: [\n    {\n      provide: UNIVERSAL_CACHE,\n      useFactory: universalCacheFactory,\n    },\n    {\n      provide: APP_ID,\n      useFactory: appIdFactory,\n      deps: []\n    },\n    {\n      provide: AUTO_PREBOOT,\n      useValue: true\n    },\n    {\n      multi: true,\n      provide: APP_BOOTSTRAP_LISTENER,\n      useFactory: appBootstrapListenerFactory,\n      deps: [ AUTO_PREBOOT ],\n    },\n  ]\n}, ] },\n];\n/** @nocollapse */\nstatic ctorParameters: ({type: any, decorators?: DecoratorInvocation[]}|null)[] = [\n{type: undefined, decorators: [{ type: Inject, args: [SharedStylesHost, ] }, ]},\n];\n}\n\nexport function platformUniversalDynamic (extraProviders?: any[]): PlatformRef {\n  const platform: PlatformRef = createPlatformFactory(platformBrowserDynamic, 'universalBrowserDynamic', [])(extraProviders);\n  return platform;\n};\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}